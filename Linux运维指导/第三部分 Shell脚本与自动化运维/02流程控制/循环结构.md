

# Shell脚本中的循环结构：for、while、until 详解

🎉 欢迎来到 Shell 脚本循环结构的详细讲解！在这篇文章中，我们将一起探索如何使用 `for`、`while` 和 `until` 这三种循环结构来让脚本更加灵活和高效。无论你是 Shell 脚本的新手还是有一定经验的开发者，这篇文章都能为你提供实用的技巧和示例。

---

### 什么是循环结构？

循环结构允许我们在满足一定条件时重复执行一段代码，直到条件不满足为止。在 Shell 脚本中，循环结构是处理重复任务的核心工具，例如遍历文件、计算总和、无限循环等。

---

## 1. `for` 循环：遍历已知范围的循环

`for` 循环适用于已知循环次数的情况，通常用于遍历一个已知的范围或数组。

### 语法格式

```bash
for 变量 in 值1 值2 值3 ...
do
    循环体
done
```

或者更简洁的写法：

```bash
for 变量 in 值列表; do
    循环体
done
```

### 示例：遍历文件名

假设我们有一个文件夹 `documents`，里面有三个文件 `file1.txt`、`file2.txt` 和 `file3.txt`。我们可以使用 `for` 循环遍历这些文件并显示其内容：

```bash
for file in documents/file1.txt documents/file2.txt documents/file3.txt; do
    echo "文件内容：$(cat $file)"
    echo "-------------------"
done
```

**输出：**

```
文件内容：这是 file1.txt 的内容
-------------------
文件内容：这是 file2.txt 的内容
-------------------
文件内容：这是 file3.txt 的内容
-------------------
```

### `for` 循环的关键点

- **变量**：在每次循环中，变量会被赋予值列表中的一个值。
- **值列表**：可以是直接列出的值，也可以是用命令生成的值（例如 `$(ls)`）。
- **范围遍历**：可以使用 `{1..5}` 来遍历 1 到 5 的整数。例如：

```bash
for i in {1..3}; do
    echo "数字：$i"
done
```

**输出：**

```
数字：1
数字：2
数字：3
```

**注意！** 如果值列表为空，`for` 循环将不会执行任何操作。

---

## 2. `while` 循环：在条件满足时循环

`while` 循环会在条件为真时重复执行循环体，直到条件变为假时退出循环。

### 语法格式

```bash
while 条件
do
    循环体
done
```

### 示例：计算 1 到 10 的和

```bash
sum=0
i=1
while [ $i -le 10 ]; do
    sum=$((sum + i))
    i=$((i + 1))
done
echo "1 到 10 的和是：$sum"
```

**输出：**

```
1 到 10 的和是：55
```

### `while` 循环的关键点

- **条件判断**：使用方括号 `[ ]` 或 `[[ ]]` 进行条件判断。
- **无限循环**：如果条件永远为真，循环将无限执行。例如：

```bash
while true; do
    echo "这是一个无限循环，按 Ctrl+C 退出"
done
```

**注意！** 如果条件判断写错，可能会导致死循环。例如：

```bash
while [ $i -lt 5 ]; do
    echo $i
done  # 这里 i 没有初始化，可能导致错误
```

**提醒！** 在使用 `while` 循环时，一定要确保条件最终会变为假，否则脚本会卡死。

---

## 3. `until` 循环：在条件不满足时循环

`until` 循环与 `while` 循环相反，它会在条件为假时循环，直到条件为真时退出循环。

### 语法格式

```bash
until 条件
do
    循环体
done
```

### 示例：验证用户输入的密码

```bash
password=""
until [ "$password" == "secret" ]; do
    read -p "请输入密码： " password
    if [ "$password" != "secret" ]; then
        echo "密码错误，请再试一次。"
    fi
done
echo "密码正确！欢迎进入系统。"
```

**输出：**

```
请输入密码： 123
密码错误，请再试一次。
请输入密码： secret
密码正确！欢迎进入系统。
```

### `until` 循环的关键点

- **条件判断**：与 `while` 循环类似，使用方括号 `[ ]` 或 `[[ ]]`。
- **适用场景**：适用于需要在条件满足之前重复执行某些操作的情况，例如验证输入或等待某个状态。

**提醒！** `until` 循环在某些情况下可以被 `while` 循环替代，但 `until` 循环更直观地表达了“直到条件满足才退出”的逻辑。

---

## 4. 循环结构的比较与选择

| 循环类型 | 适用场景                       | 语法结构                                                                 |
|----------|--------------------------------|--------------------------------------------------------------------------|
| `for`    | 已知循环次数或遍历固定值列表   | `for 变量 in 值列表; do 循环体; done`                                   |
| `while`  | 在条件为真时循环               | `while 条件; do 循环体; done`                                           |
| `until`  | 在条件为假时循环               | `until 条件; do 循环体; done`                                           |

**选择循环结构的技巧：**

- 如果你知道循环的次数或需要遍历固定值列表，选择 `for`。
- 如果需要在条件为真时循环，选择 `while`。
- 如果需要在条件为假时循环，选择 `until`。

---

## 5. 循环中的常用技巧

### 1. 使用 `break` 和 `continue` 控制循环

- `break`：退出循环。
- `continue`：跳过当前循环，进入下一次循环。

**示例：过滤偶数**

```bash
for i in {1..5}; do
    if [ $((i % 2)) -eq 0 ]; then
        continue
    fi
    echo "$i 是奇数。"
done
```

**输出：**

```
1 是奇数。
3 是奇数。
5 是奇数。
```

### 2. 使用 `$?` 检查循环中的命令状态

在循环中，可以使用 `$?` 来检查上一个命令的退出状态码。

**示例：检查文件是否存在**

```bash
file="example.txt"
while [ $? -ne 0 ]; do
    read -p "请输入要检查的文件名： " file
    ls "$file" 2>/dev/null
done
echo "文件存在！"
```

**解释：**

- `ls "$file" 2>/dev/null`：尝试列出文件，如果文件不存在，`ls` 会返回错误码 2。
- `while [ $? -ne 0 ]; do ... done`：只要 `ls` 返回非 0 退出码，循环就会继续。

---

## 6. 总结

🎉 现在你已经掌握了 Shell 脚本中 `for`、`while` 和 `until` 循环的基本用法和技巧。通过这些循环结构，你可以轻松处理重复任务，让脚本更加高效和灵活。记住以下几点：

- **`for` 循环**：适用于已知循环次数或固定值列表。
- **`while` 循环**：适用于在条件为真时循环。
- **`until` 循环**：适用于在条件为假时循环。
- **`break` 和 `continue`**：用于控制循环的流程。

**提醒！** 在编写循环时，一定要确保循环有退出的条件，否则脚本可能会陷入死循环。如果不确定，可以在循环体内添加 `echo` 语句，输出当前状态以帮助调试。

希望这篇文章对你有所帮助！如果还有疑问，欢迎在评论区留言 😊